<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/libs/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"abeltian.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="TYS的博客">
<meta property="og:url" content="http://abeltian.top/index.html">
<meta property="og:site_name" content="TYS的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="tys">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://abeltian.top/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>TYS的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="TYS的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">TYS的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">算法小白努力学习中</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2022/01/03/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%8C%BB%E5%AD%A6%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%9A%84%E4%BC%9A%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/03/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%8C%BB%E5%AD%A6%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%9A%84%E4%BC%9A%E8%AE%AE/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-03 17:55:03 / 修改时间：17:56:31" itemprop="dateCreated datePublished" datetime="2022-01-03T17:55:03+08:00">2022-01-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="医学图像处理的会议"><a href="#医学图像处理的会议" class="headerlink" title="医学图像处理的会议"></a>医学图像处理的会议</h1><p><a target="_blank" rel="noopener" href="https://2022.midl.io/call-for-papers.html">https://2022.midl.io/call-for-papers.html</a></p>
<p>Medical Imaging with Deep Learning</p>
<p>MIDL 长论文 提交deadline 12月 短论文三页 4月22号。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2022/01/01/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%B7%A5%E4%BD%9C%E8%AE%A1%E5%88%921/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/01/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%B7%A5%E4%BD%9C%E8%AE%A1%E5%88%921/" class="post-title-link" itemprop="url">工作安排</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-01 10:29:10" itemprop="dateCreated datePublished" datetime="2022-01-01T10:29:10+08:00">2022-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 12:31:59" itemprop="dateModified" datetime="2022-01-19T12:31:59+08:00">2022-01-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="工作内容"><a href="#工作内容" class="headerlink" title="工作内容"></a>工作内容</h1><p>2021.12.23-12.25</p>
<p>重叠与密集细胞区域的检测文献调研。</p>
<p>调研了两篇密集区域目标检测的文章</p>
<p>PS-RCNN 两个阶段来分别检测未遮挡与严重遮挡的目标</p>
<p>迭代检测的方法，将历史的特征图卷积后作为第二次的输入</p>
<p>查看一下目前faster-rcnn的所有密集、重叠区域检测结果的情况，挑选出了一些检测结果差的样本。</p>
<p>2021.12.25~2021.12.31</p>
<p>密集、重叠细胞区域存在的检测难点，严重遮挡的细胞智能提供较少的视觉信息，检测得到的置信度低，容易被NMS最大值抑制去除。其中一种解决方案是Soft-NMS，Soft-NMS按照检测框之间的重合程度(IOU)进行置信度衰减，但是衰减的形式为人工设计，具有较大的局限性，且置信度降低的检测框后续也可能因不满足置信度阈值的要求而被去除。</p>
<p>针对密集、重叠细胞区域存在的检测失效的问题，拟采用迭代检测的方法来检测两组具有不同遮挡的细胞实例。第一轮检测没有遮挡或者轻微遮挡的细胞，在实例分割分支会得到的已检测到细胞的mask，之后采用该mask去覆盖原特征图的相应位置得到masked feature。在第二轮检测中使用masked feature去检测被遗漏的遮挡较严重的细胞。通过这样的迭代检测方式去提升网络对被遮挡细胞的检测能力。</p>
<p><img src="C:\Users\sty\AppData\Roaming\Typora\typora-user-images\image-20211231210503997.png" alt="image-20211231210503997"></p>
<p>在该迭代检测的方法中，需要细胞边界的mask信息，因此需要使用语义分割进行细胞的位置标注。</p>
<p>先完成结果写入到labelme的json的形式，完成结果的迭代，目前完成细胞质标注约500余张，版本一迭代完成，形成了闭环，下图为mask-rcnn推断的结果，红色为细胞，绿色为细胞核。</p>
<p><img src="C:\Users\sty\AppData\Roaming\Typora\typora-user-images\image-20211231213015456.png" alt="image-20211231213015456"></p>
<p>跑一下带有mask的检测网络如mask-rcnn</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools&#x2F;train.py  configs&#x2F;mask_rcnn&#x2F;mask_rcnn_r50_fpn_2x_coco.py --work-dir .&#x2F;work_dir&#x2F;mask_rcnn_new&#x2F;</span><br></pre></td></tr></table></figure>

<p>12.29检测结果出现了问题</p>
<ol>
<li>只检测细胞边检</li>
<li>只检测细胞核边界</li>
<li>同时检测，目前存在失效的问题 不知道为什么 考虑结合语义分割网络，目前已找到问题未修改dataset coco数据集合与网络输出的分类类别，在结果写入json中出现了seg重复定义的bug。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/12/31/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/mmdetection_seg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/31/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/mmdetection_seg/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-12-31 11:27:38 / 修改时间：20:32:50" itemprop="dateCreated datePublished" datetime="2021-12-31T11:27:38+08:00">2021-12-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="mmdetection"><a href="#mmdetection" class="headerlink" title="mmdetection"></a>mmdetection</h2><p>遇到的问题 </p>
<ol>
<li><p>只检测细胞边检</p>
</li>
<li><p>只检测细胞核边界</p>
</li>
<li><p>同时检测，目前存在失效的问题 不知道为什么 考虑结合语义分割网络</p>
</li>
</ol>
<p>   目前怀疑的问题是dataset的类别没有进行改动</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/12/29/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%88%B6%E4%BD%9C%E5%8C%85%E5%90%ABmask%E7%9A%84coco%E6%95%B0%E6%8D%AE%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/29/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%88%B6%E4%BD%9C%E5%8C%85%E5%90%ABmask%E7%9A%84coco%E6%95%B0%E6%8D%AE%E9%9B%86/" class="post-title-link" itemprop="url">数据集准备</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-29 10:29:10" itemprop="dateCreated datePublished" datetime="2021-12-29T10:29:10+08:00">2021-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 12:33:14" itemprop="dateModified" datetime="2022-01-19T12:33:14+08:00">2022-01-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="制作包含mask的coco数据集"><a href="#制作包含mask的coco数据集" class="headerlink" title="制作包含mask的coco数据集"></a>制作包含mask的coco数据集</h1><h1 id="1-coco数据集格式"><a href="#1-coco数据集格式" class="headerlink" title="1. coco数据集格式"></a>1. coco数据集格式</h1><p>coco数据集的官网<a target="_blank" rel="noopener" href="https://cocodataset.org/">https://cocodataset.org/</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;annotations&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: int,</span><br><span class="line">    <span class="attr">&quot;image_id&quot;</span>: int,</span><br><span class="line">    <span class="attr">&quot;category_id&quot;</span>: int,</span><br><span class="line">    <span class="attr">&quot;segmentation&quot;</span>: RLE or [polygon],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: float,</span><br><span class="line">    <span class="attr">&quot;bbox&quot;</span>: [x,y,width,height],</span><br><span class="line">    <span class="attr">&quot;iscrowd&quot;</span>: <span class="number">0</span> or <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>标注的信息</p>
<p>cocoapi提供了将polygon转为rle格式的代码 annToRLE</p>
<p>labelme中通过group来判断边界框与mask的归属性。</p>
<h1 id="2-训练Mask-RCNN"><a href="#2-训练Mask-RCNN" class="headerlink" title="2. 训练Mask-RCNN"></a>2. 训练Mask-RCNN</h1><p>pycococreator</p>
<p>跑通了mask-rcnn跑出的分割结果是与图片大小相同的mask</p>
<h1 id="3-mmdet中对COCO类的包装"><a href="#3-mmdet中对COCO类的包装" class="headerlink" title="3. mmdet中对COCO类的包装"></a>3. mmdet中对COCO类的包装</h1><p>coco中imgToAnns记录了某一个img_id对应所有的ann_id</p>
<p>_parse_ann_info包含了一张图片的所有的bbox与segm信息</p>
<p>result2json将检测与分割的结果写为coco的json格式。</p>
<p>model.show_result展示检测结果</p>
<h1 id="4-标注的标准"><a href="#4-标注的标准" class="headerlink" title="4. 标注的标准"></a>4. 标注的标准</h1><p>对于处于边界的细胞，完整程度要大于5/6</p>
<p>对于细胞质非常小，几乎不可见的细胞种类，不标注细胞核，直接标注为细胞cell</p>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p><a target="_blank" rel="noopener" href="https://patrickwasp.com/create-your-own-coco-style-dataset/">https://patrickwasp.com/create-your-own-coco-style-dataset/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/waspinator/pycococreator/">https://github.com/waspinator/pycococreator/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/12/20/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/mmdetection%E8%AE%AD%E7%BB%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/20/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/mmdetection%E8%AE%AD%E7%BB%83/" class="post-title-link" itemprop="url">mmdetection网络训练</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-20 10:29:10" itemprop="dateCreated datePublished" datetime="2021-12-20T10:29:10+08:00">2021-12-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 12:28:19" itemprop="dateModified" datetime="2022-01-19T12:28:19+08:00">2022-01-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="mmdetection训练"><a href="#mmdetection训练" class="headerlink" title="mmdetection训练"></a>mmdetection训练</h2><p>如何制作数据集<a target="_blank" rel="noopener" href="https://github.com/spytensor/prepare_detection_dataset">https://github.com/spytensor/prepare_detection_dataset</a></p>
<p>将labelme格式的数据转化为coco格式数据，需要对文件进行改写。</p>
<p>// 修改类别，修改image字段 修改area</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">annotation[<span class="string">&#x27;area&#x27;</span>] = annotation[<span class="string">&#x27;bbox&#x27;</span>][<span class="number">2</span>]  *  annotation[<span class="string">&#x27;bbox&#x27;</span>][<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>json编辑器dadroit</p>
<p>通过目录的软连接将数据创建到data文件夹下</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/duanyajun987/article/details/97659685">https://blog.csdn.net/duanyajun987/article/details/97659685</a></p>
<p>修改mmdetection/mmdet/datasets/coco.py <code>CLASSES</code></p>
<p>mmdetection/mmdet/core/evaluation/class_names.py 修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def coco_classes():</span><br><span class="line">    return [</span><br><span class="line">        &#39;Prim&#39;, &#39;Lym&#39;, &#39;Mono&#39;, &#39;Plas&#39;, &#39;Red&#39;,&#39;Promy&#39;,&#39;Myelo&#39;,&#39;Late&#39;,&#39;Rods&#39;,&#39;Lobu&#39;,&#39;Eosl&#39;</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>修改configs/models/retinanet_r50_fpn.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_classes=<span class="number">11</span>,</span><br></pre></td></tr></table></figure>
<p>训练数据集</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/train.py configs/retinanet/retinanet_r50_fpn_1x_coco.py  --work-dir work_dirs --resume-from work_dirs/latest.pth --gpus 2</span><br></pre></td></tr></table></figure>
<p>多卡训练</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash ./tools/dist_train.sh  configs/retinanet/retinanet_r50_fpn_1x_coco.py  2  --work-dir work_dirs --resume-from work_dirs/latest.pth</span><br></pre></td></tr></table></figure>
<p>查看显卡使用情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 1 -d nvidia-smi</span><br></pre></td></tr></table></figure>

<p>真正的训练文件<code>mmdet/apis/train.py</code></p>
<p>修改epoch <code>configs/_base_/schedules/schedules_1x.py</code>的<code>runner = dict(type=&#39;EpochBasedRunner&#39;, max_epochs=240)</code>修改epoch数量</p>
<p>修改batchsize<code>configs/datasets/coco_detection.py</code> samples_per_gpu参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">data &#x3D; dict(</span><br><span class="line">    samples_per_gpu&#x3D;2,</span><br><span class="line">    workers_per_gpu&#x3D;2,</span><br><span class="line">    train&#x3D;dict(</span><br><span class="line">        type&#x3D;dataset_type,</span><br><span class="line">        ann_file&#x3D;data_root + &#39;annotations&#x2F;instances_train2017.json&#39;,</span><br><span class="line">        img_prefix&#x3D;data_root + &#39;train2017&#x2F;&#39;,</span><br><span class="line">        pipeline&#x3D;train_pipeline),</span><br><span class="line">    val&#x3D;dict(</span><br><span class="line">        type&#x3D;dataset_type,</span><br><span class="line">        ann_file&#x3D;data_root + &#39;annotations&#x2F;instances_val2017.json&#39;,</span><br><span class="line">        img_prefix&#x3D;data_root + &#39;val2017&#x2F;&#39;,</span><br><span class="line">        pipeline&#x3D;test_pipeline),</span><br><span class="line">    test&#x3D;dict(</span><br><span class="line">        type&#x3D;dataset_type,</span><br><span class="line">        ann_file&#x3D;data_root + &#39;annotations&#x2F;instances_val2017.json&#39;,</span><br><span class="line">        img_prefix&#x3D;data_root + &#39;val2017&#x2F;&#39;,</span><br><span class="line">        pipeline&#x3D;test_pipeline))</span><br></pre></td></tr></table></figure>

<h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/test.py configs/retinanet/retinanet_r50_fpn_1x_coco.py checkpoints/retinanet_r50_fpn_1x_coco_20200130-c2398f9e.pth --show</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/test.py configs/retinanet/retinanet_r50_fpn_1x_coco.py work_dirs/latest.pth --out test_result/latest.pkl --<span class="built_in">eval</span> bbox --show-<span class="built_in">dir</span> detect_results</span><br></pre></td></tr></table></figure>

<p>mmdetection 结果炫酷可视化</p>
<h5 id="TSNE"><a href="#TSNE" class="headerlink" title="TSNE"></a>TSNE</h5><p>热力图(好看的colorbar<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zb-ml/p/13561449.html">https://www.cnblogs.com/zb-ml/p/13561449.html</a>)</p>
<h3 id="docker环境"><a href="#docker环境" class="headerlink" title="docker环境"></a>docker环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dit --name sty_cell --gpus  all   -p 10022:22 --shm-size=16g  -v /mnt/sda/sty/data:/Data  nvidia/cuda:11.2.2-cudnn8-devel-ubuntu18.04</span><br></pre></td></tr></table></figure>

<p>创建docker环境，安装anaconda，安装mmcv mmdet</p>
<h2 id="训练faster-rcnn"><a href="#训练faster-rcnn" class="headerlink" title="训练faster-rcnn"></a>训练faster-rcnn</h2><p>修改 /mmdet/datasets/coco.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLASSES = ( <span class="string">&#x27;Prim&#x27;</span>, <span class="string">&#x27;Lym&#x27;</span>, <span class="string">&#x27;Mono&#x27;</span>, <span class="string">&#x27;Plas&#x27;</span>, <span class="string">&#x27;Red&#x27;</span>,<span class="string">&#x27;Promy&#x27;</span>,<span class="string">&#x27;Myelo&#x27;</span>,<span class="string">&#x27;Late&#x27;</span>,<span class="string">&#x27;Rods&#x27;</span>,<span class="string">&#x27;Lobu&#x27;</span>,<span class="string">&#x27;Eosl&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>修改config/_base_/models/faster_rcnn_r50_fpn.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_classes=<span class="number">11</span></span><br></pre></td></tr></table></figure>

<p>指定GPU训练数据集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUDA_VISIBLE_DEVICES&#x3D;1 python tools&#x2F;train.py configs&#x2F;faster_rcnn&#x2F;faster_rcnn_r50_fpn_2x_coco.py  --work-dir work_dir&#x2F;faster_rcnn </span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/12/20/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/mmdetection%20%E7%BB%93%E6%9E%9C%E8%AF%84%E4%BB%B7%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/20/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/mmdetection%20%E7%BB%93%E6%9E%9C%E8%AF%84%E4%BB%B7%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">mmdetection结果评估</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-20 10:29:10" itemprop="dateCreated datePublished" datetime="2021-12-20T10:29:10+08:00">2021-12-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 12:28:06" itemprop="dateModified" datetime="2022-01-19T12:28:06+08:00">2022-01-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mmdetection-结果评价函数"><a href="#mmdetection-结果评价函数" class="headerlink" title="mmdetection 结果评价函数"></a>mmdetection 结果评价函数</h1><p>{‘bboxes’: array([[119., 111., 244., 252.]], dtype=float32), ‘labels’: array([8]), ‘bboxes_ignore’: array([], shape=(0, 4), dtype=float32), ‘masks’: [[[119.0, 111.0, 244.0, 252.0]]], ‘seg_map’: ‘ER0437_233.png’}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools&#x2F;test.py configs&#x2F;faster_rcnn&#x2F;faster_rcnn_r50_fpn_2x_coco.py work_dir&#x2F;faster_rcnn&#x2F;epoch_80.pth --work-dir . --out .&#x2F;tmp.pkl</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools&#x2F;analysis_tools&#x2F;analyze_results.py configs&#x2F;faster_rcnn&#x2F;faster_rcnn_r50_fpn_2x_coco.py .&#x2F;tmp.pkl .&#x2F;results</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools&#x2F;train.py configs&#x2F;faster_rcnn&#x2F;faster_rcnn_r50_fpn_2x_coco.py --work-dir&#x2F; .&#x2F;work_dirs&#x2F;faster_rcnn1</span><br></pre></td></tr></table></figure>

<p>COCO数据集标注文件有三种信息</p>
<ul>
<li><p>annotations标注的列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;id&quot;: 1655,</span><br><span class="line"> &quot;image_id&quot;: 1011,</span><br><span class="line"> &quot;category_id&quot;: 1,</span><br><span class="line"> &quot;bbox&quot;: [</span><br><span class="line">  38.760299625468164,</span><br><span class="line">  84.26966292134831,</span><br><span class="line">  100.1198501872659,</span><br><span class="line">  90.47940074906366</span><br><span class="line"> ],</span><br><span class="line"> &quot;area&quot;: 9058.784048029847</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>categories标注列表</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: 1,</span><br><span class="line">  &quot;name&quot;: &quot;Prim&quot;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>images列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;height&quot;: 363,</span><br><span class="line"> &quot;width&quot;: 360,</span><br><span class="line"> &quot;id&quot;: 0,</span><br><span class="line"> &quot;file_name&quot;: &quot;ER0437_233.jpg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>coco_eval做了些什么？ </p>
<p>首先创建哈希表，_gts与_dts键位image_id与category_id，值为标注与预测bbox与类别信息。</p>
<h3 id="分析结果"><a href="#分析结果" class="headerlink" title="分析结果"></a>分析结果</h3><p>对结果进行分析</p>
<h3 id="mmdetection检测结果"><a href="#mmdetection检测结果" class="headerlink" title="mmdetection检测结果"></a>mmdetection检测结果</h3><p>单纯用Precision与Recall评价检测器并不公平，AP计算了不同Recall下的Precision，综合性地评价了检测器，PR曲线，对所有BBox给出的置信度从高到低进行排序，当把置信度取某一个值S时，依次对前n个大于置信度的BBox计算Precison与Recall得到一组(P, R)结果。在计算AP时，都要对P-R曲线做一次修正，将P值修正为当r&gt;R时最大的P</p>
</li>
</ul>
<p>  $$<br>  Precision = \frac{TP}{TP + FP} \<br>  Recall = \frac{TP}{TP + FN} \<br>  AP = \int_{0}^{1} \max({P(r) | r \ge R}) dR<br>  $$<br>  对于BBox是TP还是FP的算法判断，如某一个BBox预测的label为1，则需要计算其与该图片中所有label为1的GT Box的IOU值，当大于iou_thres时，则该预测box为TP，否则为FP。当某一个GT被置信度最大的BBox匹配后，会从GT Box集合中移除。</p>
<p>  TP + FN为测试集中该种类的样本的个数，因此不需要计算FN的个数，一个BBox与GT BOX是一一对应的，最后未检出的GT为FN</p>
<p>  <img src="https://pic3.zhimg.com/v2-8a3da2c2d827d784662ceff1e72474ce_r.jpg" alt="preview"></p>
<p>  类别平衡问题，mAP，所有类别的检测性能(AP)取平均，就是检测算法在这个IOU下的性能。</p>
<h5 id="位置偏差"><a href="#位置偏差" class="headerlink" title="位置偏差"></a>位置偏差</h5><p>  不同场景下对预测位置准确度的要求不同。 mmAP，设置一组iou阈值，每一个IOU</p>
<p>  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/60707912">https://zhuanlan.zhihu.com/p/60707912</a> 画出不同IOU下的PR曲线。</p>
<p>  可以计算一个mAP，对这些性能取平均，在coco数据集中，mAP的计算针对10个IOU阈值下的AP取平均值<code>np.linspace(0.5, 0.95, 10)</code>。</p>
<p>  <a target="_blank" rel="noopener" href="https://blog.csdn.net/lppfwl/article/details/108018950">https://blog.csdn.net/lppfwl/article/details/108018950</a></p>
<p>  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/55575423">https://zhuanlan.zhihu.com/p/55575423</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/11/29/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/#%20%E8%AE%AD%E7%BB%83%E7%BB%93%E6%9E%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/29/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/#%20%E8%AE%AD%E7%BB%83%E7%BB%93%E6%9E%9C/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-11-29 12:11:03 / 修改时间：21:03:34" itemprop="dateCreated datePublished" datetime="2021-11-29T12:11:03+08:00">2021-11-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="训练结果"><a href="#训练结果" class="headerlink" title="训练结果"></a>训练结果</h1><h3 id="使用AdamW余弦退火算法，参数如下的训练结果"><a href="#使用AdamW余弦退火算法，参数如下的训练结果" class="headerlink" title="使用AdamW余弦退火算法，参数如下的训练结果"></a>使用AdamW余弦退火算法，参数如下的训练结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2021.11.29 今日跑完了transformer-fg 结果一般 到了80%的准确度后未提升。训练faster-rcnn 计算map各个分类下的曲线</span><br></pre></td></tr></table></figure>

<p>明日计划完成faster-rcnn输出的特征热力图，与各个分类的map曲线，画一下分类Token的TSNE降维后的数据。</p>
<p>文献调研，调研一下骨髓血细胞分类的历史文献，并做PPT。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/10/26/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Ant%20Design%20UI%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/26/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Ant%20Design%20UI%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">Ant Design UI框架</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-26 10:29:10" itemprop="dateCreated datePublished" datetime="2021-10-26T10:29:10+08:00">2021-10-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 12:25:38" itemprop="dateModified" datetime="2022-01-19T12:25:38+08:00">2022-01-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Ant-Design-UI框架学习"><a href="#Ant-Design-UI框架学习" class="headerlink" title="Ant Design UI框架学习"></a>Ant Design UI框架学习</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/700777ea9db0">https://www.jianshu.com/p/700777ea9db0</a></p>
<p>采用钩子函数useState，使该函数成为有状态函数组件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/10/19/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Pytorch%20Tensor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/19/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Pytorch%20Tensor/" class="post-title-link" itemprop="url">pytorch tensor张量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-19 10:29:10" itemprop="dateCreated datePublished" datetime="2021-10-19T10:29:10+08:00">2021-10-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 12:30:05" itemprop="dateModified" datetime="2022-01-19T12:30:05+08:00">2022-01-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Pytorch-Tensor"><a href="#Pytorch-Tensor" class="headerlink" title="Pytorch Tensor"></a>Pytorch Tensor</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/64551412">https://zhuanlan.zhihu.com/p/64551412</a></p>
<p>$\qquad$Tensor多维数组底层实现是使用一块连续内存的1维数组，Tensor在元信息里保存了多维数组的形状，在访问元素时，通过多维度索引转化成1维数组相对于数组起始位置的偏移量即可找到对应的数据。</p>
<p>$\qquad$某些Tensor操作（<a href="https://link.zhihu.com/?target=https://stackoverflow.com/questions/48915810/pytorch-contiguous">如transpose、permute、narrow、expand</a>）与原Tensor是共享内存中的数据，不会改变底层数组的存储，但原来在语义上相邻、内存里也相邻的元素在执行这样的操作后，在语义上相邻，但在内存不相邻，即不连续了（<em>is not contiguous</em>）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">window_partition</span>(<span class="params">x, window_size</span>):</span></span><br><span class="line">    B, H, W, C = x.shape</span><br><span class="line">    x = x.view(B, H // window_size, window_size, W // window_size, window_size, C)</span><br><span class="line">    windows = x.permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>).contiguous().view(-<span class="number">1</span>, window_size, window_size, C)</span><br><span class="line">    <span class="keyword">return</span> windows</span><br></pre></td></tr></table></figure>

<p>以上述代码为例，在permute后，只是改变了tensor的元信息，现坐标相对于一维数组的变化，上述代码permute后，每个坐标对应的stride会发生改变。stride可以理解为每个下标的权重。</p>
<p>数组 t 在内存中实际以一维数组形式存储，通过 <strong>flatten</strong> 方法查看 t 的一维展开形式，实际存储形式与一维展开一致。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://abeltian.top/2021/10/14/%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/%E9%AA%A8%E9%AB%93%E8%A1%80%E7%BB%86%E8%83%9E%E6%A3%80%E6%B5%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="tys">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TYS的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/14/%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB/%E9%AA%A8%E9%AB%93%E8%A1%80%E7%BB%86%E8%83%9E%E6%A3%80%E6%B5%8B/" class="post-title-link" itemprop="url">骨髓血细胞检测</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-14 21:53:31" itemprop="dateCreated datePublished" datetime="2021-10-14T21:53:31+08:00">2021-10-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-10-20 19:30:55" itemprop="dateModified" datetime="2021-10-20T19:30:55+08:00">2021-10-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="文献阅读"><a href="#文献阅读" class="headerlink" title="文献阅读"></a>文献阅读</h3><h5 id="Morphogo-An-Automatic-Bone-Marrow-Cell-Classification-System-on-Digital-Images-Analyzed-by-Artificial-Intelligence"><a href="#Morphogo-An-Automatic-Bone-Marrow-Cell-Classification-System-on-Digital-Images-Analyzed-by-Artificial-Intelligence" class="headerlink" title="Morphogo: An Automatic Bone Marrow Cell Classification System on Digital Images Analyzed by Artificial Intelligence"></a>Morphogo: An Automatic Bone Marrow Cell Classification System on Digital Images Analyzed by Artificial Intelligence</h5><p>骨髓血细胞检测难点</p>
<ul>
<li>正常骨髓中的细胞类别较多，包含处于不同发育阶段从早期到功能成熟的的间充质细胞、内皮细胞和造血细胞</li>
<li></li>
</ul>
<h5 id="Human-level-recognition-of-blast-cells-in-acute-myeloid-leukaemia-with-convolutional-neural-networks"><a href="#Human-level-recognition-of-blast-cells-in-acute-myeloid-leukaemia-with-convolutional-neural-networks" class="headerlink" title="Human-level recognition of blast cells in acute myeloid leukaemia with convolutional neural networks"></a>Human-level recognition of blast cells in acute myeloid leukaemia with convolutional neural networks</h5><ul>
<li>数字化过程，使用低倍镜，选择单层细胞且无重叠区域，每个细胞的形态学特征可以更好的被识别，将细胞划分与 AML 的形态学分类相关的子类别。对于每个AOI，使用100倍的油浸镜挑选并标注100个左右的白细胞。</li>
<li>观察者间的差异，多人对同一批数据进行标注。 观察者内部的差异与自我一致性，多个月后同一人重新标注。</li>
<li>采用Resnext网络，采用五折交叉验证进行训练，对于数据集采用随机划分的方式。可以按病人进行划分，避免训练与测试集的相关性，但是检测结果差别不大。</li>
<li>类别不均衡问题采用旋转，随机水平或者垂直反转来扩充数据集。</li>
<li>评价指标，准确率、敏感性、特异性。positave与negative是指是否属于某一个特定类别的数量。TP与TF为网络正确判定是否属于该类别图像的数量。</li>
<li>gold standard annotation 最佳标注的一种描述。通过该细胞与其他区域细胞的对比确定该细胞的类别。</li>
<li>描述网络检测结果 混淆矩阵，特征图</li>
</ul>
<h5 id="Hierarchical-Vision-Transformer-using-Shifted-Windows"><a href="#Hierarchical-Vision-Transformer-using-Shifted-Windows" class="headerlink" title="Hierarchical Vision Transformer using Shifted Windows"></a>Hierarchical Vision Transformer using Shifted Windows</h5><ul>
<li>自然语言处理与视觉任务的差别，视觉目标尺寸变化较大 ，而自然语言处理中的word token大小固定。对于高分图像，self-attention计算复杂度是图像的大小的平方时间复杂度。</li>
<li>shift of the window</li>
<li>VIT缺点 在密集的视觉任务或高分辨图像中，不适合作为通用的backbone</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/411311520">https://zhuanlan.zhihu.com/p/411311520</a></li>
</ul>
<h5 id="Squeeze-and-Excitation-Networks"><a href="#Squeeze-and-Excitation-Networks" class="headerlink" title="Squeeze-and-Excitation Networks"></a>Squeeze-and-Excitation Networks</h5><ul>
<li><p>convolutional filters are expected to be informative combinations by fusing spatial and channel-wise information together within local receptive fields.</p>
</li>
<li><p>自适应的调整通道间的相应，通过对通道间的相关性进行建模。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tys"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">tys</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">63</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/sty16" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;sty16" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tys</span>
</div>
  <div class="powered-by">由 <a href="https://abeltian.top/" class="theme-link">tys</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/libs/anime.min.js"></script>
  <script src="/libs/velocity/velocity.min.js"></script>
  <script src="/libs/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
